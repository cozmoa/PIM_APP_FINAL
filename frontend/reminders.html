<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Reminders • PIM</title>
  <style>
    :root {
      --bg:#0a0a0a; --card:#111; --ink:#f5f5f5; --muted:#bdbdbd;
      --field:#1f1f1f; --border:#333; --accent:#fff; --accent-ink:#000;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:15px system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:800px;margin:24px auto;padding:0 16px}
    .top{display:flex;align-items:center;gap:10px;margin-bottom:16px}
    .back{color:var(--muted);text-decoration:none;padding:6px 10px;border:1px solid var(--border);border-radius:8px}
    .back:hover{background:#121212}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.2);border-radius:14px;padding:18px;box-shadow:0 8px 24px rgba(0,0,0,.5)}
    h1{margin:0 0 14px}
    label{display:block;font-size:13px;color:var(--muted);margin:10px 0 6px}
    input{width:100%;background:var(--field);border:1px solid var(--border);color:var(--ink);padding:10px 12px;border-radius:10px}
    input:focus{border-color:#fff;box-shadow:0 0 0 3px rgba(255,255,255,.12);outline:none}
    .btn{margin-top:14px;padding:10px 14px;border:1px solid rgba(255,255,255,.5);background:var(--accent);color:var(--accent-ink);border-radius:10px;font-weight:700;cursor:pointer}
    .list{margin-top:20px;display:grid;gap:10px}
    .rem{background:#151515;border:1px solid #2d2d2d;border-radius:10px;padding:12px;display:flex;justify-content:space-between;align-items:center}
    .muted{color:var(--muted);font-size:12px}
    .btn.small{padding:6px 10px;font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <a class="back" href="dashboard.html">← Back</a>
      <h1>Reminders</h1>
    </div>

    <div class="card">
      <label for="title">Reminder Title</label>
      <input id="title" placeholder="e.g., Meeting with team"/>

      <label for="time">When</label>
      <input id="time" type="datetime-local"/>

      <button class="btn" onclick="addReminder()">Add Reminder</button>

      <div class="list" id="reminderList"></div>
    </div>
  </div>

  <script>
    const username = localStorage.getItem("username") || "guest";
    const REM_KEY = `${username}_reminders`;

    function loadReminders(){
      return JSON.parse(localStorage.getItem(REM_KEY) || "[]");
    }
    function saveReminders(rem){ localStorage.setItem(REM_KEY, JSON.stringify(rem)); }

    function renderReminders(){
      const list = document.getElementById("reminderList");
      const rems = loadReminders();
      list.innerHTML="";
      rems.forEach((r,i)=>{
        const div=document.createElement("div");
        div.className="rem";
        div.innerHTML=`<div><div>${r.title}</div><div class="muted">${new Date(r.time).toLocaleString()}</div></div>`;
        const btn=document.createElement("button");
        btn.className="btn small"; btn.textContent="Delete";
        btn.onclick=()=>{ 
          const arr=loadReminders(); arr.splice(i,1); saveReminders(arr); renderReminders();
        };
        div.appendChild(btn);
        list.appendChild(div);
      });
    }

    function addReminder(){
      const title=document.getElementById("title").value.trim();
      const time=document.getElementById("time").value;
      if(!title||!time){alert("Enter title and time");return;}
      const arr=loadReminders();
      arr.push({title,time});
      saveReminders(arr);
      renderReminders();
      document.getElementById("title").value="";
      document.getElementById("time").value="";
    }

    // --- Notifications ---
    async function ensurePermission(){
      if(Notification.permission==="default"){
        await Notification.requestPermission();
      }
    }

    function checkReminders(){
      const now=new Date();
      const arr=loadReminders();
      arr.forEach((r,i)=>{
        const when=new Date(r.time);
        if(when<=now){
          if(Notification.permission==="granted"){
            new Notification("Reminder",{body:r.title});
          }else{
            alert("Reminder: "+r.title);
          }
          arr.splice(i,1);
          saveReminders(arr);
          renderReminders();
        }
      });
    }

    // --- Init ---
    ensurePermission();
    renderReminders();
    setInterval(checkReminders,30*1000); // check every 30s
  </script>
</body>
</html>